module NinjaDocs
  def self.path
    File.expand_path File.dirname(__FILE__)
  end
end

module Shinobi
  def self.doit command
    $stdout.puts "#{command}"
    result = system command
    raise "Failed: #{command}" unless result
  end
end

desc 'Removes generated documents'
task :clean do
  Shinobi::doit "find '#{NinjaDocs::path}' -iwholename '**/*.html' -type f -delete"
  Shinobi::doit "rm -rf '#{NinjaDocs::path}/.ninjadocs/' '#{NinjaDocs::path}/.sass_cache/'"
end

task :clean_sass do
  Shinobi::doit "rm -rf #{NinjaDocs::path}/sass_cache/"
end

task :run => [:clean] do
  Shinobi::doit "ruby #{NinjaDocs::path}/ninjadocs --in #{NinjaDocs::path}/docs --out #{NinjaDocs::path}/html"
  Shinobi::doit "open #{NinjaDocs::path}/html/index.html"
end

task :default => [:run] do
  Rake::Task[:clean_sass].invoke
end
